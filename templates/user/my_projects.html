<script>
    let projectToDelete = null;
    
    function confirmDelete(projectId, projectName) {
        console.log('================================================================================');
        console.log('ðŸ—‘ï¸ DELETE BUTTON CLICKED');
        console.log('Project ID:', projectId);
        console.log('Project Name:', projectName);
        console.log('================================================================================');
        
        projectToDelete = projectId;
        document.getElementById('modalProjectName').textContent = projectName;
        document.getElementById('deleteModal').style.display = 'block';
    }
    
    function closeModal() {
        console.log('âŒ Modal closed');
        document.getElementById('deleteModal').style.display = 'none';
        projectToDelete = null;
    }
    
    window.onclick = function(event) {
        const modal = document.getElementById('deleteModal');
        if (event.target == modal) {
            closeModal();
        }
    }
    
    async function deleteProject() {
        if (!projectToDelete) {
            console.error('âŒ No project selected for deletion');
            showToast('error', 'âŒ No project selected');
            return;
        }
        
        console.log('================================================================================');
        console.log('ðŸš€ STARTING DELETE REQUEST');
        console.log('Project ID:', projectToDelete);
        console.log('================================================================================');
        
        const btn = document.getElementById('confirmDeleteBtn');
        btn.disabled = true;
        btn.textContent = 'Deleting...';
        
        try {
            const url = `/project-delete/${projectToDelete}`;
            console.log('ðŸ“¡ Sending request to:', url);
            
            const response = await fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            });
            
            console.log('ðŸ“¥ Response status:', response.status);
            console.log('ðŸ“¥ Response ok:', response.ok);
            
            const contentType = response.headers.get('content-type');
            console.log('ðŸ“¥ Content-Type:', contentType);
            
            let data;
            if (contentType && contentType.includes('application/json')) {
                data = await response.json();
            } else {
                const text = await response.text();
                console.error('âŒ Non-JSON response:', text.substring(0, 500));
                throw new Error('Server returned non-JSON response. Check Flask console for errors.');
            }
            
            console.log('ðŸ“¦ Response data:', data);
            
            if (response.ok && data.success) {
                console.log('âœ… Delete successful!');
                showToast('success', 'âœ… Project deleted successfully!');
                closeModal();
                
                setTimeout(() => {
                    console.log('ðŸ”„ Reloading page...');
                    window.location.reload();
                }, 1500);
            } else {
                console.error('âŒ Delete failed:', data.message || 'Unknown error');
                showToast('error', 'âŒ ' + (data.message || 'Delete failed'));
                btn.disabled = false;
                btn.textContent = 'Delete Project';
            }
        } catch (error) {
            console.error('ðŸ’¥ Error during deletion:', error);
            console.error('ðŸ’¥ Error stack:', error.stack);
            showToast('error', 'âŒ An error occurred: ' + error.message);
            btn.disabled = false;
            btn.textContent = 'Delete Project';
        }
        
        console.log('================================================================================');
    }
    
    function showToast(type, message) {
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toastMessage');
        const toastIcon = document.getElementById('toastIcon');
        
        toast.className = `toast ${type}`;
        toastMessage.textContent = message;
        toastIcon.textContent = type === 'success' ? 'âœ…' : 'âŒ';
        
        toast.style.display = 'block';
        
        setTimeout(() => {
            toast.style.display = 'none';
        }, 3000);
    }
    
    console.log('âœ… My Projects page loaded');
    console.log('Total projects on page: {{ projects|length if projects else 0 }}');
</script>