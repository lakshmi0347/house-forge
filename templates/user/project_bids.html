<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Bids - House-Forge</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root{--cream:#FAF8F5;--warm-white:#FFFFFF;--sand:#F0EBE3;--stone:#E2D9CE;--accent:#B5804F;--accent-dark:#8C5E35;--accent-light:#F7EDE2;--text-primary:#1C1917;--text-secondary:#6B5E52;--text-muted:#9C8E84;--shadow-sm:0 1px 3px rgba(28,25,23,0.06);--shadow-md:0 4px 16px rgba(28,25,23,0.08);}
        *{margin:0;padding:0;box-sizing:border-box;}
        body{font-family:'DM Sans',sans-serif;background:var(--cream);min-height:100vh;color:var(--text-primary);position:relative;}
        body::before{content:'';position:fixed;inset:0;background:url('/static/images/house.jpg') no-repeat center/cover;opacity:0.08;z-index:0;pointer-events:none;}

        /* NAVBAR */
        .navbar{background:var(--warm-white);border-bottom:1px solid var(--stone);padding:0 40px;height:68px;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:100;box-shadow:var(--shadow-sm);}
        .navbar-brand{font-family:'Playfair Display',serif;font-size:22px;font-weight:700;color:var(--text-primary);display:flex;align-items:center;gap:10px;text-decoration:none;}
        .navbar-menu{display:flex;align-items:center;gap:4px;}
        .navbar-menu a{color:var(--text-secondary);text-decoration:none;padding:8px 14px;border-radius:8px;font-size:14px;font-weight:500;transition:all 0.2s;}
        .navbar-menu a:hover{color:var(--accent);background:var(--accent-light);}
        .profile-pic{width:36px;height:36px;border-radius:50%;object-fit:cover;border:2px solid var(--stone);}
        .profile-placeholder{width:36px;height:36px;border-radius:50%;background:var(--accent-light);color:var(--accent);display:flex;align-items:center;justify-content:center;font-weight:600;font-size:14px;border:2px solid var(--stone);}

        /* LAYOUT */
        .container{max-width:1060px;margin:36px auto;padding:0 24px;position:relative;z-index:1;}
        .back-link{display:inline-flex;align-items:center;gap:6px;color:var(--accent);font-size:14px;font-weight:600;text-decoration:none;margin-bottom:20px;transition:gap 0.2s;}
        .back-link:hover{gap:10px;}

        /* PAGE HEADER */
        .page-header{background:var(--warm-white);border:1px solid var(--stone);border-radius:16px;padding:30px 40px;margin-bottom:24px;box-shadow:var(--shadow-md);}
        .page-header h1{font-family:'Playfair Display',serif;font-size:26px;font-weight:700;color:var(--text-primary);margin-bottom:8px;}
        .project-meta{display:flex;gap:20px;color:var(--text-muted);font-size:13px;flex-wrap:wrap;}
        .project-meta span{display:flex;align-items:center;gap:5px;}
        .divider{width:40px;height:3px;background:var(--accent);border-radius:2px;margin:10px 0 14px;}

        /* STATS */
        .stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:24px;}
        @media(max-width:768px){.stats-grid{grid-template-columns:repeat(2,1fr);}}
        .stat-card{background:var(--warm-white);border:1px solid var(--stone);border-radius:14px;padding:22px;box-shadow:var(--shadow-sm);transition:all 0.25s;text-align:center;}
        .stat-card:hover{transform:translateY(-3px);box-shadow:var(--shadow-md);border-color:var(--accent);}
        .stat-icon{font-size:26px;margin-bottom:8px;display:block;}
        .stat-number{font-family:'Playfair Display',serif;font-size:34px;font-weight:700;color:var(--text-primary);line-height:1;margin-bottom:4px;}
        .stat-label{color:var(--text-muted);font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.8px;}

        /* ALERTS */
        .alert{padding:13px 16px;border-radius:8px;margin-bottom:18px;font-size:14px;}
        .alert-success{background:#D1FAE5;color:#065F46;border:1px solid #A7F3D0;}
        .alert-error{background:#FEE2E2;color:#991B1B;border:1px solid #FECACA;}

        /* BID CARD */
        .bid-card{background:var(--warm-white);border:1px solid var(--stone);border-radius:16px;padding:28px;margin-bottom:18px;box-shadow:var(--shadow-sm);transition:all 0.25s;}
        .bid-card:hover{box-shadow:var(--shadow-md);border-color:rgba(181,128,79,0.3);}
        .bid-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:20px;}
        .contractor-info{display:flex;align-items:center;gap:14px;}
        .contractor-avatar{width:52px;height:52px;border-radius:50%;background:var(--accent-light);border:2px solid var(--stone);display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0;}
        .contractor-name{font-family:'Playfair Display',serif;font-size:17px;font-weight:600;color:var(--text-primary);margin-bottom:3px;}
        .contractor-sub{font-size:13px;color:var(--text-secondary);}
        .contractor-rating{font-size:12px;color:var(--text-muted);margin-top:3px;}

        /* STATUS BADGES */
        .status-badge{display:inline-block;padding:5px 14px;border-radius:20px;font-size:11px;font-weight:700;letter-spacing:0.5px;text-transform:uppercase;white-space:nowrap;flex-shrink:0;}
        .status-pending{background:#FEF3C7;color:#92400E;}
        .status-accepted{background:#D1FAE5;color:#065F46;}
        .status-rejected{background:#FEE2E2;color:#991B1B;}

        /* BID DETAILS GRID */
        .bid-details{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;padding:18px 20px;background:var(--sand);border-radius:10px;margin:18px 0;}
        @media(max-width:600px){.bid-details{grid-template-columns:repeat(2,1fr);}}
        .detail-item{text-align:center;}
        .detail-label{font-size:11px;color:var(--text-muted);font-weight:600;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:6px;}
        .detail-value{font-size:17px;font-weight:700;color:var(--text-primary);}
        .detail-value.accent{color:var(--accent);}

        /* PROPOSAL */
        .bid-proposal{padding:14px 16px;background:var(--cream);border:1px solid var(--stone);border-radius:8px;font-size:14px;line-height:1.65;color:var(--text-secondary);margin:14px 0;}
        .bid-proposal strong{color:var(--text-primary);}
        .bid-timestamp{font-size:11px;color:var(--text-muted);margin-top:8px;}

        /* BID ACTIONS */
        .bid-actions{display:flex;gap:10px;margin-top:16px;}
        .btn-accept{flex:1;padding:11px 20px;background:var(--accent);color:white;border:none;border-radius:8px;font-weight:600;font-size:13px;cursor:pointer;transition:all 0.2s;font-family:'DM Sans',sans-serif;}
        .btn-accept:hover{background:var(--accent-dark);transform:translateY(-1px);}
        .btn-reject{flex:1;padding:11px 20px;background:transparent;color:#DC2626;border:1.5px solid #FECACA;border-radius:8px;font-weight:600;font-size:13px;cursor:pointer;transition:all 0.2s;font-family:'DM Sans',sans-serif;}
        .btn-reject:hover{background:#FEE2E2;}
        .btn-view{padding:11px 20px;background:var(--sand);color:var(--text-secondary);border:1px solid var(--stone);border-radius:8px;font-weight:600;font-size:13px;text-decoration:none;transition:all 0.2s;white-space:nowrap;}
        .btn-view:hover{background:var(--stone);}

        /* EMPTY STATE */
        .empty-state{text-align:center;padding:60px 20px;background:var(--warm-white);border:1px solid var(--stone);border-radius:16px;}
        .empty-icon{font-size:56px;margin-bottom:16px;opacity:0.5;}
        .empty-state h2{font-family:'Playfair Display',serif;font-size:20px;color:var(--text-primary);margin-bottom:8px;}
        .empty-state p{color:var(--text-muted);font-size:14px;}

        @keyframes fadeUp{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}
        .page-header{animation:fadeUp 0.5s ease both;}
        .stats-grid{animation:fadeUp 0.5s 0.1s ease both;}
        .bid-card{animation:fadeUp 0.5s 0.15s ease both;}
    </style>
</head>
<body>
    <nav class="navbar">
        <a href="{{ url_for('user.dashboard') }}" class="navbar-brand">üèóÔ∏è House-Forge</a>
        <div class="navbar-menu">
            <a href="{{ url_for('user.dashboard') }}">Dashboard</a>
            <a href="{{ url_for('user.projects') }}">My Projects</a>
            <a href="{{ url_for('user.profile') }}" style="padding:8px 10px;">
                {% if user_profile_picture %}
                    <img src="/static/uploads/profiles/{{ user_profile_picture }}" alt="Profile" class="profile-pic">
                {% else %}
                    <div class="profile-placeholder">{{ current_user.name[0].upper() if current_user.name else 'U' }}</div>
                {% endif %}
            </a>
            <a href="{{ url_for('auth.logout') }}" style="color:var(--text-muted);font-size:13px;">Logout</a>
        </div>
    </nav>

    <div class="container">
        <a href="{{ url_for('user.view_project', project_id=project.id) }}" class="back-link">‚Üê Back to Project</a>

        <div class="page-header">
            <h1>üìã Bids for {{ project.title }}</h1>
            <div class="divider"></div>
            <div class="project-meta">
                <span>üìè {{ project.square_feet }} sq ft</span>
                <span>üìç {{ project.location }}</span>
                <span>üí∞ {{ project.budget_range.title() }} Budget</span>
            </div>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}{% for category, message in messages %}
            <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}{% endif %}
        {% endwith %}

        <div class="stats-grid">
            <div class="stat-card"><span class="stat-icon">üìã</span><div class="stat-number">{{ stats.total }}</div><div class="stat-label">Total Bids</div></div>
            <div class="stat-card"><span class="stat-icon">‚è≥</span><div class="stat-number">{{ stats.pending }}</div><div class="stat-label">Pending</div></div>
            <div class="stat-card"><span class="stat-icon">‚úÖ</span><div class="stat-number">{{ stats.accepted }}</div><div class="stat-label">Accepted</div></div>
            <div class="stat-card"><span class="stat-icon">‚ùå</span><div class="stat-number">{{ stats.rejected }}</div><div class="stat-label">Rejected</div></div>
        </div>

        {% if bids %}
            {% for bid in bids %}
            <div class="bid-card">
                <div class="bid-header">
                    <div class="contractor-info">
                        <div class="contractor-avatar">üî®</div>
                        <div>
                            <div class="contractor-name">{{ bid.contractor_company or bid.contractor_name }}</div>
                            <div class="contractor-sub">{{ bid.contractor_name if bid.contractor_company else 'Professional Contractor' }}</div>
                            <div class="contractor-rating">‚≠ê {{ "%.1f"|format(bid.contractor_rating or 0) }} ¬∑ {{ bid.contractor_experience or 0 }} yrs experience</div>
                        </div>
                    </div>
                    <span class="status-badge status-{{ bid.status }}">
                        {% if bid.status == 'pending' %}‚è≥ Pending{% elif bid.status == 'accepted' %}‚úÖ Accepted{% else %}‚ùå Rejected{% endif %}
                    </span>
                </div>

                <div class="bid-details">
                    <div class="detail-item">
                        <div class="detail-label">Total Cost</div>
                        <div class="detail-value accent">‚Çπ{{ "{:,.0f}".format(bid.total_cost) }}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Duration</div>
                        <div class="detail-value">{{ bid.duration_days }} days</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Materials</div>
                        <div class="detail-value">‚Çπ{{ "{:,.0f}".format(bid.material_cost or 0) }}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Labour</div>
                        <div class="detail-value">‚Çπ{{ "{:,.0f}".format(bid.labor_cost or 0) }}</div>
                    </div>
                </div>

                <div class="bid-proposal"><strong>Proposal:</strong><br>{{ bid.proposal }}</div>
                <div class="bid-timestamp">Submitted: {{ bid.created_at.strftime('%d %b %Y, %I:%M %p') if bid.created_at else 'N/A' }}</div>

                {% if bid.status == 'pending' %}
                <div class="bid-actions">
                    <form method="POST" action="{{ url_for('user.accept_bid', bid_id=bid.id) }}" onsubmit="return confirm('Accept this bid?');" style="flex:1;">
                        <button type="submit" class="btn-accept" style="width:100%;">‚úÖ Accept Bid</button>
                    </form>
                    <form method="POST" action="{{ url_for('user.reject_bid', bid_id=bid.id) }}" onsubmit="return confirm('Reject this bid?');" style="flex:1;">
                        <button type="submit" class="btn-reject" style="width:100%;">‚ùå Reject Bid</button>
                    </form>
                    <a href="{{ url_for('user.view_contractor', contractor_id=bid.contractor_id) }}" class="btn-view">View Profile</a>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <div class="empty-icon">üìã</div>
                <h2>No Bids Yet</h2>
                <p>No contractors have submitted bids for this project yet.</p>
            </div>
        {% endif %}
    </div>
</body>
</html>